#!/bin/bash
set -e

echo "ðŸ”§ Repairing production migration history..."

# Set the Supabase CLI path
SUPABASE_CLI="./supabase-cli"

# Ensure we have the password
if [ -z "$SUPABASE_DB_PASSWORD" ]; then
  source .env.local
fi

# Mark all old migrations as reverted so they won't be expected
$SUPABASE_CLI migration repair --status reverted \
  20240526000000 20240526000001 20240526000002 20240527000000 \
  20240528000000 20240528000004 20240529000001 20240529000002 \
  20240529000003 20240529000004 20240529000005 20240529000006 \
  20240529000007 20240529000008 20250526120917 20250527000000 \
  20250527000001 20250527000002 20250527000003 20250527000004 \
  20250527000006 20250527182540 20250527184018 20250527185230 \
  20250527190501 20250527191502 20250528095452 20250528150000 \
  20250528160000 20250528161000 20250528170000 20250528171000 \
  20250528172000 20250528172603 20250528173000 20250528180000 \
  20250528180133 20250528183000 20250528185000 20250528190000 \
  20250528191000 20250528192000 20250529142736

echo "âœ… Migration history repaired. You can now run db push."